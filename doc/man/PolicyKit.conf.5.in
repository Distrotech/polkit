.\" -*- Nroff -*-
.\" PolicyKit.conf manual page.
.\" Copyright (C) 2007 David Zeuthen <david@fubar.dk>
.\"
.TH POLICYKIT.CONF 5
.SH NAME
@sysconfdir@/PolicyKit/PolicyKit.conf \- PolicyKit configuration file
.SH DESCRIPTION
.PP

The 
.I @sysconfdir@/PolicyKit/PolicyKit.conf 
configuration file provides a way for system administrators to
override policy that mechanisms use
.I libpolkit
to determine whether a caller is privileged to use the mechanism in the way specified by the given
.I action
identifier.

Changes to this configuration file are not immediately propagated; the
utility \&\fIpolkit-reload-config\fR\|(1) can be used to notify
running processes of the changes to the configuration file.

.B TODO: 
we need to have a tool to verify the PolicyKit.conf file.

For more information about the big picture refer to the \fIPolicyKit
spec\fP which can be found in
.I "@docdir@/spec/polkit-spec.html"
depending on the distribution.

.SH CONFIGURATION FILE
.PP

The configuration file is an XML document. It must
have the following doctype declaration:

 <!DOCTYPE pkconfig PUBLIC "-//freedesktop//DTD PolicyKit Configuration 1.0//EN"
 "http://hal.freedesktop.org/releases/PolicyKit/1.0/config.dtd">

The following elements may be present in the configuration file

.I config

Root element. A single attribute
.I version
must be present and must be set to
.I "0.1"
at this point. There can only be one
.I config
element in the configuration file.

.I match

This element is for matching information related to the decision
making process and includes values describing both the caller and the
action. This element can be embedded in both
.I config
and other
.I match
elements (hence allowing for nested matching).

There can only be a single attribute in each
.I match
element and POSIX Extended Regular Expression syntax are supported in
the value part. The following attributes are supported:

.I
.TP
.B user
This matches on the user's login name.
.TP
.B action
For matching on the action, for example
.B action="org.freedesktop.hal.storage.*"
will match on all actions whose name begins with the string with "org.freedesktop.hal.storage.".

.PP

.I return

This element is for used to specify what result
.I libpolkit
should return. It can only be embedded in 
.I config
and 
.I match
elements and can embed no elements itself. The
.I return
element is typically used deeply inside a number of
.I match
elements. A single attribute 
.I result
is supported and it can assume the following values

.TP
.B no
Access denied.
.TP
.B auth_admin
Access denied, but authentication of the caller as root will grant
access to only that caller.
.TP
.B auth_admin_keep_session
Access denied, but authentication of the caller as root will grant
access for the remainder of the session the caller stems from.
.TP
.B auth_admin_keep_always
Access denied, but authentication of the caller as root will grant
access to the user of the caller in the future.
.TP
.B auth_self
Access denied, but authentication of the caller as himself will grant
access to only that caller.
.TP
.B auth_self_keep_session
Access denied, but authentication of the caller as himself will grant
access for the remainder of the session the caller stems from.
.TP
.B auth_self_keep_always
Access denied, but authentication of the caller as himself will grant
access to the user of the caller in the future.
.TP
.B yes
Access granted.

.PP

.I define_admin_auth

This element is used to specify the meaning of "authenticate as
administrator". It is normally used at the top-level but can also be
used deep inside a number of 
.I match
elements for conditional behavior. 

There can only be a single attribute in each
.I define_admin_auth
element. POSIX Extended Regular Expression syntax are 
.B not 
supported in the value part, however multiple values to match on can
be separated with the bar (|) character. The following attributes
are supported:

.TP
.B user
Administrator authentication means authenticate as the given user.
If no
.I define_admin_auth
element is given, the default is to use
.B user="root"
e.g. administrator authentication mean authenticate as the super user.

.TP
.B group
Administrator authentication means that any user in the groups matching
the given value can be used to authenticate. Typically, on a system 
with the root account disabled one wants to use something like
.B group="wheel"
to e.g. enable all UNIX users in the UNIX group
.B wheel
to be able to authentication whenever administrator authentication
is required.

.SH EXAMPLES

For brevity the standard XML and doctype headers are omitted in the
following configuration file examples. The actions used may also be
fictional, use \&\fIpolkit-list-actions\fR\|(1) to learn about the
actions installed on the system.

.I ALLOW EVERYTHING

  <config version="0.1">
.br
    <match user="davidz|bateman">
.br
      <return result="yes"/>
.br
    </match>
.br
  </config>
.br

The two UNIX users "davidz" and "bateman" to do any action.

.I MOUNTING FIXED DRIVES

Suppose the action
.I org.freedesktop.hal.storage.mount-fixed
is used by \&\fIhald\fR\|(8) to determine whether mounting internal
hard drives are allowed. Then this configuration file

  <config version="0.1">
.br
    <match action="org.freedesktop.hal.storage.mount-fixed">
      <match user="davidz">
.br
        <return result="yes"/>
.br
      </match>
      <match user="freddy">
.br
        <return result="no"/>
.br
      </match>
.br
    </match>
.br
  </config>
.br

specifies that UNIX user "davidz" is always allowed to do the action,
while UNIX user "freddy" is never allowed to do the action.

.SH BUGS
.PP
Please send bug reports to either the distribution or the HAL
mailing list, see 
.I "http://lists.freedesktop.org/mailman/listinfo/hal"
on how to subscribe.

.SH SEE ALSO
.PP
\&\fIPolicyKit\fR\|(8),
\&\fIpolkit-list-actions\fR\|(1)


.SH AUTHOR
Written by David Zeuthen <david@fubar.dk> with a lot of help from many
others.

